# Postfix main.cf - minimal relay configuration generated by Ansible
myhostname = {{ ansible_fqdn | default('proxmox-host') }}
myorigin = /etc/mailname
mydestination = localhost
relayhost = {% if smtp_relay_enabled and smtp_relay_host %}[{{ smtp_relay_host }}]:{{ smtp_relay_port }}{% else %} 
{% endif %}
inet_interfaces = loopback-only
inet_protocols = all

# TLS / Auth
{% if smtp_relay_use_tls %}
smtpd_tls_security_level = may
smtp_use_tls = yes
smtp_tls_security_level = may
smtp_tls_note_starttls_offer = yes
{% endif %}

{% if smtp_relay_auth %}
# SASL auth for relay
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
smtp_sasl_security_options = noanonymous
{% endif %}

# Prevent local delivery for non-local domains
local_transport = error:local delivery disabled
