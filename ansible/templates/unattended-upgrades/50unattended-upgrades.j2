# Generated by Ansible - DO NOT EDIT MANUALLY

// Allowed origins for automatic upgrades
Unattended-Upgrade::Origins-Pattern {
    // Debian security updates (CRITICAL - always enabled)
    "origin=Debian,codename=${distro_codename},label=Debian-Security";
    "origin=Debian,codename=${distro_codename}-security,label=Debian-Security";
    
    // Debian stable updates
    "origin=Debian,codename=${distro_codename},label=Debian";
{% if unattended_upgrades_proxmox_updates %}
    
    // Proxmox VE updates (enable with caution!)
    "origin=Proxmox,codename=${distro_codename},label=Proxmox Debian Repository";
{% endif %}
};

// Packages to NEVER automatically upgrade (CRITICAL for hypervisors!)
Unattended-Upgrade::Package-Blacklist {
    // Kernel updates - require manual testing and reboot planning
    "linux-image-*";
    "linux-headers-*";
    "linux-.*-pve";
    
    // Proxmox core components - update manually with `apt upgrade`
    "pve-kernel-*";
    "proxmox-ve";
    "pve-manager";
    "pve-cluster";
    "pve-ha-manager";
    "pve-qemu-kvm";
    
    // Ceph storage (if using Ceph)
    "ceph";
    "ceph-*";
    "librados*";
    "librbd*";
    
    // ZFS (if using ZFS)
    "zfs-*";
    "zfsutils-*";
    "libnvpair*";
    "libuutil*";
    "libzfs*";
    "libzpool*";
};

// Auto-fix interrupted dpkg operations
Unattended-Upgrade::AutoFixInterruptedDpkg "true";

// Split upgrades into small chunks (allows graceful interruption)
Unattended-Upgrade::MinimalSteps "true";

// Email notification settings
{% if unattended_upgrades_email %}
Unattended-Upgrade::Mail "{{ unattended_upgrades_email }}";
Unattended-Upgrade::MailReport "{{ unattended_upgrades_mail_report }}";
{% else %}
// Unattended-Upgrade::Mail "";
{% endif %}

// Cleanup settings
Unattended-Upgrade::Remove-Unused-Kernel-Packages "false";  // Manual for PVE!
Unattended-Upgrade::Remove-New-Unused-Dependencies "true";
Unattended-Upgrade::Remove-Unused-Dependencies "true";

// REBOOT SETTINGS - CRITICAL FOR PROXMOX!
{% if unattended_upgrades_auto_reboot %}
// WARNING: Auto-reboot enabled - ensure VMs are properly configured for host shutdown!
Unattended-Upgrade::Automatic-Reboot "true";
Unattended-Upgrade::Automatic-Reboot-WithUsers "{{ unattended_upgrades_reboot_with_users | lower }}";
Unattended-Upgrade::Automatic-Reboot-Time "{{ unattended_upgrades_reboot_time }}";
{% else %}
// Auto-reboot DISABLED (recommended for production hypervisors)
Unattended-Upgrade::Automatic-Reboot "false";
{% endif %}

// Logging
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";

// Only upgrade on AC power (skip on battery/UPS)
Unattended-Upgrade::OnlyOnACPower "false";  // Disabled for servers

// Verbose logging for troubleshooting
// Unattended-Upgrade::Verbose "false";
// Unattended-Upgrade::Debug "false";

// Generated by Ansible - DO NOT EDIT MANUALLY
// Unattended-Upgrade configuration for Proxmox VE

// Allowed origins for automatic upgrades
Unattended-Upgrade::Origins-Pattern {
    // Debian security updates (CRITICAL - always enabled)
    "origin=Debian,codename=${distro_codename},label=Debian-Security";
    "origin=Debian,codename=${distro_codename}-security,label=Debian-Security";
    
    // Debian stable updates
    "origin=Debian,codename=${distro_codename},label=Debian";
{% if unattended_upgrades_proxmox_updates %}
    
    // Proxmox VE updates (enable with caution!)
    "origin=Proxmox,codename=${distro_codename},label=Proxmox Debian Repository";
{% endif %}
};

// Packages to NEVER automatically upgrade (CRITICAL for hypervisors!)
Unattended-Upgrade::Package-Blacklist {
    // Kernel updates - require manual testing and reboot planning
    "linux-image-*";
    "linux-headers-*";
    "linux-.*-pve";
    
    // Proxmox core components - update manually with `apt upgrade`
    "pve-kernel-*";
    "proxmox-ve";
    "pve-manager";
    "pve-cluster";
    "pve-ha-manager";
    "pve-qemu-kvm";
    
    // Ceph storage (if using Ceph)
    "ceph";
    "ceph-*";
    "librados*";
    "librbd*";
    
    // ZFS (if using ZFS)
    "zfs-*";
    "zfsutils-*";
    "libnvpair*";
    "libuutil*";
    "libzfs*";
    "libzpool*";
};

// Auto-fix interrupted dpkg operations
Unattended-Upgrade::AutoFixInterruptedDpkg "true";

// Split upgrades into small chunks (allows graceful interruption)
Unattended-Upgrade::MinimalSteps "true";

// Email notification settings
{% if unattended_upgrades_email %}
Unattended-Upgrade::Mail "{{ unattended_upgrades_email }}";
Unattended-Upgrade::MailReport "{{ unattended_upgrades_mail_report }}";
{% else %}
// Unattended-Upgrade::Mail "";
{% endif %}

// Cleanup settings
Unattended-Upgrade::Remove-Unused-Kernel-Packages "false";  // Manual for PVE!
Unattended-Upgrade::Remove-New-Unused-Dependencies "true";
Unattended-Upgrade::Remove-Unused-Dependencies "true";

// REBOOT SETTINGS - CRITICAL FOR PROXMOX!
{% if unattended_upgrades_auto_reboot %}
// WARNING: Auto-reboot enabled - ensure VMs are properly configured for host shutdown!
Unattended-Upgrade::Automatic-Reboot "true";
Unattended-Upgrade::Automatic-Reboot-WithUsers "{{ unattended_upgrades_reboot_with_users | lower }}";
Unattended-Upgrade::Automatic-Reboot-Time "{{ unattended_upgrades_reboot_time }}";
{% else %}
// Auto-reboot DISABLED (recommended for production hypervisors)
Unattended-Upgrade::Automatic-Reboot "false";
{% endif %}

// Logging
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";

// Only upgrade on AC power (skip on battery/UPS)
Unattended-Upgrade::OnlyOnACPower "false";  // Disabled for servers

// Verbose logging for troubleshooting
// Unattended-Upgrade::Verbose "false";
// Unattended-Upgrade::Debug "false";
