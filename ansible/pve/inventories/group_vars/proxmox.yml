---
# General Configurations
dns_servers:
  - 10.0.0.1
domains:
  - hosted.fail
ntp_servers:
  - time.cloudflare.com
notify_email: ""  # e.g., "admin@example.com"
timezone: "America/Detroit"

# ACME / TLS Configurations
acme_enabled: true
acme_account_name: "default"
acme_account_email: "admin@hosted.fail"
acme_directory_url: "https://acme-v02.api.letsencrypt.org/directory"
acme_plugin_name: "Cloudflare"      # Matches plugin ID on host
acme_plugin_type: "dns"             # standalone (http-01) or dns
acme_plugin_api: "cf"               # Required when acme_plugin_type == "dns"
acme_plugin_nodes: []               # Optional list of nodes when using DNS plugins
acme_plugin_validation_delay: 60
acme_cloudflare_api_token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62653366613431373632396666613564666366393637316634323236373333393237383833343335
          3839353633643230323961346663323537343035396261340a373033313061663532303834613064
          35646165373131376334663431633566353539356530653834343035353864613332316636386562
          3634306136626161660a333335373331613039613066633565363730393335323764303733366539
          64316332613032626463393330333639316231353939666261326230303765376136366432373765
          6530643162306639666232393733326633613634383864643833
acme_cloudflare_account_id: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34646631643637663465336336316231363665653931666133383831346466363033666264366133
          6439656134336633336530373365656539386332303164610a636263616436313263333563386364
          33303333656666636464376662383164636562383964346530393431666464316132303734356566
          3632333539626365380a393264336134376465313631323238326438326335643563666162626331
          32303737373334633435623136623130356663393831326663646534636565356638333335313139
          6133383432376461666463303939653465356463613262646562
acme_cloudflare_zone_id: ""         # Not used on this host
acme_plugin_data_b64: "{{ [
    ('CF_Token=' ~ acme_cloudflare_api_token) if (acme_cloudflare_api_token | length) > 0 else '',
    ('CF_Account_ID=' ~ acme_cloudflare_account_id) if (acme_cloudflare_account_id | length) > 0 else '',
    ('CF_Zone_ID=' ~ acme_cloudflare_zone_id) if (acme_cloudflare_zone_id | length) > 0 else ''
  ] | reject('equalto','') | join('\n') | b64encode }}"
acme_domains:
  - domain: "pve.hosted.fail"
    plugin: "{{ acme_plugin_name }}"
    alias: ""
acme_force_renew: false

# Syslog Configurations
syslog_enabled: true
syslog_server: "syslog.hosted.fail"
syslog_port: 514
syslog_protocol: "udp"

# Log Rotation Configurations
logrotate_custom_enabled: true
logrotate_configs:
  - name: "clamav-host-scan"
    paths:
      - /var/log/clamav-host-scan.log
    rotate: 7
    interval: daily
    compress: true
    missingok: true
    notifempty: true
  - name: "rkhunter-daily"
    paths:
      - /var/log/rkhunter-daily.log
    rotate: 7
    interval: weekly
    compress: true
    missingok: true
    notifempty: true

# NUT (Network UPS Tools) Configurations
nut_enabled: true
nut_mode: "standalone"      # Options: standalone, netserver, netclient
nut_ups_name: "cyberpower"
nut_ups_driver: "usbhid-ups"
nut_ups_port: "auto"
nut_ups_vendor_id: "0764"
nut_ups_product_id: "0601"  # PR1500LCDRT2U
nut_ups_serial: ""
nut_monitor_user: "upsmon"
nut_monitor_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37336265323136626661623963383338663337353535313166393734376663396162303634356261
          6633326434303634376635383962643163396366363532610a643033623533626436353565633165
          32343937356665623235303832636337636464303064393934393266366562376261326332366466
          6233343932306436350a393439303565336334343432373033653462653135306263623538386432
          36333761343766313364343262656638326366626631373031323034353362366437313736306632
          3666353831633035323564646636653138346661653732616138
nut_server: "127.0.0.1"     # Only used for netclient mode

# Unattended Upgrades Configurations
apt_include_non_free_firmware: true
unattended_upgrades_enabled: true
unattended_upgrades_email: ""                 # e.g., "admin@example.com" - Leave empty to disable email
unattended_upgrades_mail_report: "on-change"  # Options: always, only-on-error, on-change
unattended_upgrades_proxmox_updates: false
unattended_upgrades_auto_reboot: false 
unattended_upgrades_reboot_with_users: false
unattended_upgrades_reboot_time: "02:00"

# GPU Passthrough and IOMMU Configurations
gpu_passthrough_enabled: true
gpu_blacklist_modules:
  - nvidiafb
  - nouveau
  - nvidia
  - nvidia_drm
  - nvidia_modeset
  - rivafb
  - snd_hda_codec_hdmi
  - snd_hda_intel
  - snd_hda_codec
  - snd_hda_core
  - radeon
  - amdgpu
  - i915
  - xe
gpu_force_probe_options:
  - module: i915
    device_id: "56a6"
  - module: xe
    device_id: "56a6"
enable_iommu: true
iommu_vendor: 'auto'
iommu_extra_options: ""
iommu_update_grub: true
iommu_require_reboot: true

# Sysctl Hardening Configurations
sysctl_hardening_enabled: true
sysctl_hardening_values:
  kernel.kptr_restrict: 2
  kernel.dmesg_restrict: 1
  kernel.perf_event_paranoid: 3
  kernel.yama.ptrace_scope: 1
  kernel.unprivileged_bpf_disabled: 1
  kernel.kexec_load_disabled: 1
  net.ipv4.conf.all.accept_redirects: 0
  net.ipv4.conf.default.accept_redirects: 0
  net.ipv4.conf.all.accept_source_route: 0
  net.ipv4.conf.default.accept_source_route: 0
  net.ipv4.conf.all.log_martians: 1
  net.ipv4.conf.default.log_martians: 1
  net.ipv4.conf.all.rp_filter: 1
  net.ipv4.conf.default.rp_filter: 1
  net.ipv4.conf.all.send_redirects: 0
  net.ipv4.conf.default.send_redirects: 0
  net.ipv4.tcp_syncookies: 1
  net.ipv6.conf.all.accept_redirects: 0
  net.ipv6.conf.default.accept_redirects: 0
  vm.mmap_rnd_bits: 32
  vm.mmap_rnd_compat_bits: 16

# Kernel Lockdown Configurations
kernel_lockdown_enabled: true
kernel_lockdown_mode: "integrity"
kernel_lockdown_sig_enforce: false  # Enable after verifying lockdown=integrity boots cleanly
kernel_extra_cmdline_params:
  - "video=efifb:off"

# Terraform Provisioner Configurations
terraform_prov_role_name: "Terraform"
terraform_prov_role_privs: "Datastore.AllocateSpace Datastore.AllocateTemplate Datastore.Audit Pool.Allocate Sys.Audit Sys.Console Sys.Modify VM.Allocate VM.Audit VM.Clone VM.Config.CDROM VM.Config.Cloudinit VM.Config.CPU VM.Config.Disk VM.Config.HWType VM.Config.Memory VM.Config.Network VM.Config.Options VM.Migrate VM.PowerMgmt SDN.Use"
terraform_prov_username: "terraform@pve"
terraform_prov_user_password: ""

# Fail2Ban Configurations
fail2ban_enabled: true
fail2ban_ignore_ip:
  - 127.0.0.1
  - 10.0.1.126
fail2ban_maxretry: 3
fail2ban_findtime: "2h"
fail2ban_bantime: "1h"

# SMTP Relay Configurations
smtp_relay_enabled: false
smtp_relay_host: ""
smtp_relay_port: 25
smtp_relay_use_tls: false
smtp_relay_auth: false
smtp_relay_user: ""
smtp_relay_password: ""

# ZFS Tuning Configurations
zfs_tuning_enabled: true
zfs_tuning:
  zfs_arc_max: 103079215104           # 96 GiB in bytes
  zfs_arc_min: 34359738368            # 32 GiB in bytes
  zfs_dirty_data_max: 34359738368     # 32 GiB in bytes
  zfs_dirty_data_max_percent: 20
  zfs_dirty_data_sync_percent: 10
  zfs_vdev_aggregation_limit: 1048576

# Antivirus Configurations
host_antivirus_enabled: true
host_antivirus_scan_paths:
  - /srv
  - /etc
clamav_freshclam_update: true
clamav_scan_opts: "--multiscan --infected"

# Rootkit Hunter Configurations
rkhunter_enabled: true
rkhunter_update_databases: true
rkhunter_scan_opts: "--checkall"

# Proxmox Exporter Configurations
pve_exporter_enabled: true
pve_exporter_version: "latest"
pve_exporter_listen_address: "127.0.0.1:9221"

# Auditd Configurations
audit_pve_rules_enabled: true
audit_pve_rules_path: /etc/audit/rules.d/90-pve.rules
audit_pve_watch_path: /etc/pve
auditd_hardening_enabled: false
auditd_hardening_rules:
  - "-w /etc/passwd -p wa -k identity"
  - "-w /etc/shadow -p wa -k identity"
  - "-w /etc/group -p wa -k identity"
  - "-w /etc/sudoers -p wa -k sudoers"
  - "-w /etc/ssh/sshd_config -p wa -k sshd"
  - "-w /var/log/auth.log -p wa -k auth"
  - "-w /var/log/syslog -p wa -k syslog"
  - "-a always,exit -F arch=b64 -S execve -k exec_log"
  - "-a always,exit -F arch=b32 -S execve -k exec_log"
