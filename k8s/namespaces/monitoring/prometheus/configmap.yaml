apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config-map
  namespace: monitoring
data:
  values.yaml: |-
    server:
      replicaCount: 1
      tolerations:
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
        - key: node-role.kubernetes.io/master
          operator: Exists
          effect: NoSchedule
      resources:
        requests:
          cpu: 250m
          memory: 512Mi
        limits:
          cpu: 1000m
          memory: 1Gi
      persistentVolume:
        enabled: true
        existingClaim: prometheus-server
        size: 20Gi
        storageClass: local-path-rwo
      retention: 168h
      extraScrapeConfigs: |
        - job_name: alloy
          kubernetes_sd_configs:
            - role: endpoints
          relabel_configs:
            - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
              action: keep
              regex: monitoring;alloy;prom-metrics
        - job_name: tempo
          kubernetes_sd_configs:
            - role: endpoints
          relabel_configs:
            - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
              action: keep
              regex: monitoring;tempo;tempo-http
    alertmanager:
      enabled: true
      tolerations:
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
        - key: node-role.kubernetes.io/master
          operator: Exists
          effect: NoSchedule
    kube-state-metrics:
      tolerations:
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
    prometheus-node-exporter:
      tolerations:
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
    prometheus-pushgateway:
      enabled: false
    rbac:
      create: true
