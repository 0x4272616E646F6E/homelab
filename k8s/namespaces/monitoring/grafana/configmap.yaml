apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-config-map
  namespace: monitoring
data:
  values.yaml: |-
    resources:
      requests:
        cpu: 150m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

      admin:
        existingSecret: "grafana-secrets"

    tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Exists
        effect: NoSchedule
      - key: node-role.kubernetes.io/master
        operator: Exists
        effect: NoSchedule

    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
          - name: Prometheus
            uid: prometheus
            type: prometheus
            access: proxy
            url: http://prometheus-server.monitoring.svc.cluster.local:80
            jsonData:
              httpMethod: POST
            isDefault: true
          - name: Loki
            uid: loki
            type: loki
            access: proxy
            url: http://loki.monitoring.svc.cluster.local:3100
          - name: Tempo
            uid: tempo
            type: tempo
            access: proxy
            url: http://tempo.monitoring.svc.cluster.local:3200
            jsonData:
              tracesToMetrics:
                datasourceUid: prometheus
              lokiSearch:
                datasourceUid: loki

    dashboardProviders:
      dashboardproviders.yaml:
        apiVersion: 1
        providers:
          - name: homelab
            orgId: 1
            folder: Homelab
            type: file
            disableDeletion: false
            editable: true
            options:
              path: /var/lib/grafana/dashboards/homelab

    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
      datasources:
        enabled: false
      alerts:
        enabled: false
      plugins:
        enabled: false
      notifiers:
        enabled: false
