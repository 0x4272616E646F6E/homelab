apiVersion: v1
kind: ConfigMap
metadata:
  name: tempo-config-map
  namespace: monitoring
data:
  values.yaml: |-
    replicas: 1

    tempo:
      resources:
        requests:
          cpu: 200m
          memory: 512Mi
        limits:
          cpu: 1000m
          memory: 1Gi
      memBallastSizeMbs: 256
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
            http:
              endpoint: 0.0.0.0:4318
      retention: 48h
      ingester:
        max_block_duration: 5m
      storage:
        trace:
          backend: local
          local:
            path: /var/tempo/traces
          wal:
            path: /var/tempo/wal
      global_overrides:
        max_bytes_per_trace: 25000000
        metrics_generator_disabled: true
      metricsGenerator:
        enabled: false
        ring:
          kvstore:
            store: inmemory
      memberlist:
        join_members: []
      persistence:
        enabled: true
        storageClassName: local-path-rwo
        accessModes: ["ReadWriteOnce"]
        size: 20Gi

    service:
      ports:
        - name: tempo-http
          port: 3200
          targetPort: 3200
        - name: otlp-grpc
          port: 4317
          targetPort: 4317
        - name: otlp-http
          port: 4318
          targetPort: 4318

    serviceMonitor:
      enabled: true
      interval: 30s
      additionalLabels:
        release: prometheus

    tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Exists
        effect: NoSchedule
      - key: node-role.kubernetes.io/master
        operator: Exists
        effect: NoSchedule
