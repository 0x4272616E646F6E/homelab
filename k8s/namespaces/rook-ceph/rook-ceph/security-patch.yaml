---
# This patch file adds missing NET_RAW capability and ensures the ms_learn_addr_from_peer is set correctly
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: rook-ceph
  namespace: rook-ceph
spec:
  postRenderers:
    - kustomize:
        patches:
          # Remove capability drops from all OSD pods
          - patch: |
              apiVersion: apps/v1
              kind: Deployment
              metadata:
                name: rook-ceph-osd-0
                namespace: rook-ceph
              spec:
                template:
                  spec:
                    containers:
                    - name: osd
                      securityContext:
                        capabilities:
                          drop: []
            target:
              kind: Deployment
              name: rook-ceph-osd-0
              namespace: rook-ceph