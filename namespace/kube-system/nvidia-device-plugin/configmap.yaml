apiVersion: v1
kind: ConfigMap
metadata:
  name: nvidia-device-plugin-config-map
  namespace: kube-system
data:
  values.yaml: |-
    config:
      map:
        default: |-
          version: v1
          flags:
            migStrategy: none
          sharing:
            timeSlicing:
              renameByDefault: false
              failRequestsGreaterThanOne: false
              resources:
                - name: nvidia.com/gpu
                  replicas: 8
      default: "default"
      fallbackStrategies: ["named","single"]

    image:
      repository: nvcr.io/nvidia/k8s-device-plugin
      pullPolicy: IfNotPresent
      tag: "v0.17.3"

    updateStrategy:
      type: RollingUpdate

    # Explicitly override any chart default affinity
    affinity: {}
    nodeSelector: {}
    
    # Add tolerations to handle any potential future taints
    tolerations:
    - operator: "Exists"  # Will tolerate any taint

    priorityClassName: system-node-critical

    devicePlugin:
      enabled: true

    gfd:
      enabled: false
    nfd:
      enableNodeFeatureApi: false

    resources: {}